const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-wNU7y3o8.js","assets/index-DyMURg1I.js","assets/index-_0L7VFBF.css"])))=>i.map(i=>d[i]);
import{g as O,h as G,r as u,l as D,n as S,L as C,_ as c,k as n,s as P,j as L,t as k,d as nt,H as it,b as rt,i as Z,v as T,J as lt,T as $,K as ct,M as q,N as dt,O as K,y as F,D as pt,z as mt,A as ut,P as ft,Q as yt,I as gt,R as bt,S as xt,E as H}from"./index-DyMURg1I.js";function vt(t){return G("MuiListItem",t)}const h=O("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]),It=O("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);function ht(t){return G("MuiListItemSecondaryAction",t)}O("MuiListItemSecondaryAction",["root","disableGutters"]);const Ct=["className"],Lt=t=>{const{disableGutters:e,classes:s}=t;return k({root:["root",e&&"disableGutters"]},ht,s)},wt=P("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.disableGutters&&e.disableGutters]}})(({ownerState:t})=>c({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})),Y=u.forwardRef(function(e,s){const a=D({props:e,name:"MuiListItemSecondaryAction"}),{className:i}=a,l=S(a,Ct),r=u.useContext(C),p=c({},a,{disableGutters:r.disableGutters}),m=Lt(p);return n.jsx(wt,c({className:L(m.root,i),ownerState:p,ref:s},l))});Y.muiName="ListItemSecondaryAction";const At=["className"],$t=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],St=(t,e)=>{const{ownerState:s}=t;return[e.root,s.dense&&e.dense,s.alignItems==="flex-start"&&e.alignItemsFlexStart,s.divider&&e.divider,!s.disableGutters&&e.gutters,!s.disablePadding&&e.padding,s.button&&e.button,s.hasSecondaryAction&&e.secondaryAction]},Pt=t=>{const{alignItems:e,button:s,classes:a,dense:i,disabled:l,disableGutters:r,disablePadding:p,divider:m,hasSecondaryAction:o,selected:d}=t;return k({root:["root",i&&"dense",!r&&"gutters",!p&&"padding",m&&"divider",l&&"disabled",s&&"button",e==="flex-start"&&"alignItemsFlexStart",o&&"secondaryAction",d&&"selected"],container:["container"]},vt,a)},jt=P("div",{name:"MuiListItem",slot:"Root",overridesResolver:St})(({theme:t,ownerState:e})=>c({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!e.disablePadding&&c({paddingTop:8,paddingBottom:8},e.dense&&{paddingTop:4,paddingBottom:4},!e.disableGutters&&{paddingLeft:16,paddingRight:16},!!e.secondaryAction&&{paddingRight:48}),!!e.secondaryAction&&{[`& > .${It.root}`]:{paddingRight:48}},{[`&.${h.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${h.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:T.alpha(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${h.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:T.alpha(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${h.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},e.alignItems==="flex-start"&&{alignItems:"flex-start"},e.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},e.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${h.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:T.alpha(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:T.alpha(t.palette.primary.main,t.palette.action.selectedOpacity)}}},e.hasSecondaryAction&&{paddingRight:48})),Rt=P("li",{name:"MuiListItem",slot:"Container",overridesResolver:(t,e)=>e.container})({position:"relative"}),Nt=u.forwardRef(function(e,s){const a=D({props:e,name:"MuiListItem"}),{alignItems:i="center",autoFocus:l=!1,button:r=!1,children:p,className:m,component:o,components:d={},componentsProps:g={},ContainerComponent:j="li",ContainerProps:{className:R}={},dense:f=!1,disabled:y=!1,disableGutters:v=!1,disablePadding:w=!1,divider:Q=!1,focusVisibleClassName:X,secondaryAction:z,selected:tt=!1,slotProps:et={},slots:st={}}=a,ot=S(a.ContainerProps,At),at=S(a,$t),E=u.useContext(C),B=u.useMemo(()=>({dense:f||E.dense||!1,alignItems:i,disableGutters:v}),[i,E.dense,f,v]),_=u.useRef(null);nt(()=>{l&&_.current&&_.current.focus()},[l]);const I=u.Children.toArray(p),U=I.length&&it(I[I.length-1],["ListItemSecondaryAction"]),N=c({},a,{alignItems:i,autoFocus:l,button:r,dense:B.dense,disabled:y,disableGutters:v,disablePadding:w,divider:Q,hasSecondaryAction:U,selected:tt}),V=Pt(N),W=rt(_,s),M=st.root||d.Root||jt,A=et.root||g.root||{},b=c({className:L(V.root,A.className,m),disabled:y},at);let x=o||"li";return r&&(b.component=o||"div",b.focusVisibleClassName=L(h.focusVisible,X),x=lt),U?(x=!b.component&&!o?"div":x,j==="li"&&(x==="li"?x="div":b.component==="li"&&(b.component="div")),n.jsx(C.Provider,{value:B,children:n.jsxs(Rt,c({as:j,className:L(V.container,R),ref:W,ownerState:N},ot,{children:[n.jsx(M,c({},A,!Z(M)&&{as:x,ownerState:c({},N,A.ownerState)},b,{children:I})),I.pop()]}))})):n.jsx(C.Provider,{value:B,children:n.jsxs(M,c({},A,{as:x,ref:W},!Z(M)&&{ownerState:c({},N,A.ownerState)},b,{children:[I,z&&n.jsx(Y,{children:z})]}))})});function Mt(t){return G("MuiListItemAvatar",t)}O("MuiListItemAvatar",["root","alignItemsFlexStart"]);const Tt=["className"],Ot=t=>{const{alignItems:e,classes:s}=t;return k({root:["root",e==="flex-start"&&"alignItemsFlexStart"]},Mt,s)},Dt=P("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.alignItems==="flex-start"&&e.alignItemsFlexStart]}})(({ownerState:t})=>c({minWidth:56,flexShrink:0},t.alignItems==="flex-start"&&{marginTop:8})),kt=u.forwardRef(function(e,s){const a=D({props:e,name:"MuiListItemAvatar"}),{className:i}=a,l=S(a,Tt),r=u.useContext(C),p=c({},a,{alignItems:r.alignItems}),m=Ot(p);return n.jsx(Dt,c({className:L(m.root,i),ownerState:p,ref:s},l))}),Bt=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],_t=t=>{const{classes:e,inset:s,primary:a,secondary:i,dense:l}=t;return k({root:["root",s&&"inset",l&&"dense",a&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},ct,e)},Ft=P("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[{[`& .${q.primary}`]:e.primary},{[`& .${q.secondary}`]:e.secondary},e.root,s.inset&&e.inset,s.primary&&s.secondary&&e.multiline,s.dense&&e.dense]}})(({ownerState:t})=>c({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},t.primary&&t.secondary&&{marginTop:6,marginBottom:6},t.inset&&{paddingLeft:56})),Gt=u.forwardRef(function(e,s){const a=D({props:e,name:"MuiListItemText"}),{children:i,className:l,disableTypography:r=!1,inset:p=!1,primary:m,primaryTypographyProps:o,secondary:d,secondaryTypographyProps:g}=a,j=S(a,Bt),{dense:R}=u.useContext(C);let f=m??i,y=d;const v=c({},a,{disableTypography:r,inset:p,primary:!!f,secondary:!!y,dense:R}),w=_t(v);return f!=null&&f.type!==$&&!r&&(f=n.jsx($,c({variant:R?"body2":"body1",className:w.primary,component:o!=null&&o.variant?void 0:"span",display:"block"},o,{children:f}))),y!=null&&y.type!==$&&!r&&(y=n.jsx($,c({variant:"body2",className:w.secondary,color:"text.secondary",display:"block"},g,{children:y}))),n.jsxs(Ft,c({className:L(w.root,l),ownerState:v,ref:s},j,{children:[f,y]}))}),J=async(t,e,s)=>{const a=await createImageBitmap(t),i=document.createElement("canvas");return i.width=a.width,i.height=a.height,i.getContext("2d").drawImage(a,0,0),new Promise(l=>i.toBlob(r=>l({blob:r,size:r.size,url:URL.createObjectURL(r)}),`image/${e}`,s))},zt=async(t,e)=>{let s;t instanceof Blob?s=t:s=await(await fetch(t)).blob(),K.saveAs(s,e)},Et=async t=>{const{default:e}=await dt(async()=>{const{default:i}=await import("./jszip.min-wNU7y3o8.js").then(l=>l.j);return{default:i}},__vite__mapDeps([0,1,2])),s=new e;for(const{blob:i,name:l}of t){const r=i instanceof Blob?i:await(await fetch(i)).blob();s.file(l,r)}const a=await s.generateAsync({type:"blob"});K.saveAs(a,"shinobi.zip")};function Vt(){const t=F(o=>o.downloadModalOpen),e=()=>F.getState().closeDownloadModal(),{items:s,selected:a,global:i}=F.getState(),r=(a.size?s.filter(o=>a.has(o.id)):s).flatMap(o=>(Array.isArray(o.formats)?o.formats:[]).map(g=>({id:o.id,file:o.file,fmt:g,q:o.q??i.q,baseName:(o.customName||o.name).replace(/\.[^/.]+$/,""),thumb:o.urlC||o.url,sizeO:o.sizeO}))),p=async()=>{const o=[];for(const d of r){const{blob:g}=await J(d.file,d.fmt,d.q);o.push({blob:g,name:`${d.baseName}.${d.fmt}`})}Et(o)},m=async o=>{const{blob:d}=await J(o.file,o.fmt,o.q);zt(d,`${o.baseName}.${o.fmt}`)};return n.jsxs(pt,{open:t,onClose:e,fullWidth:!0,maxWidth:"sm",role:"dialog","aria-labelledby":"download-dialog-title",children:[n.jsx(mt,{id:"download-dialog-title",children:"Download"}),n.jsx(ut,{children:r.length>0?n.jsxs(n.Fragment,{children:[n.jsx(ft,{"aria-label":"Files to download",sx:{maxHeight:300,overflowY:"auto"},children:r.map((o,d)=>n.jsxs(Nt,{secondaryAction:n.jsx(gt,{"aria-label":`Download ${o.baseName}.${o.fmt}`,onClick:()=>m(o),children:n.jsx(bt,{})}),children:[n.jsx(kt,{children:n.jsx(yt,{src:o.thumb})}),n.jsx(Gt,{primary:`${o.baseName}.${o.fmt}`,secondary:`${(o.sizeO/1024).toFixed(1)} KB`})]},`${o.id}-${o.fmt}-${d}`))}),n.jsxs(xt,{direction:{xs:"column",sm:"row"},spacing:1,mt:2,children:[n.jsx(H,{"aria-label":"Download ZIP of selected formats",variant:"contained",fullWidth:!0,onClick:p,children:"Download ZIP"}),n.jsx(H,{"aria-label":"Download each in all formats",variant:"outlined",fullWidth:!0,onClick:p,children:"Download in all formats"})]})]}):n.jsx($,{children:"No files to download"})})]})}export{Vt as default};
